## 网络应用的体系结构

- 客户机/服务器(Client-Server, C/S)
- 点对点(P2P)
- 混合结构(Hybrid)

### 客户机/服务器结构

例子：Web

### P2P

优点：高度可伸缩
缺点：难于管理

### 混合结构

文件传输使用P2P结构
文件搜索采用C/S结构

## 网络应用进程通信

进程：主机上运行的程序

套接字：Socket，进程间通信利用socket发送/接受消息实现，类似于寄信，传输基础设施向进程提供API

不同主机上的进程间通信，每个进程必须拥有标识符，如何寻址主机？——IP地址、端口号

网络应用需遵循应用层协议，公开协议(由RFC定义)
- 消息类型：请求/响应消息
- 消息的语法/格式
- 字段的语义
- 规则

## 网络应用对传输服务的需求
- 数据丢失/可靠性
- 时间/延迟
- 带宽

### Internet提供的传输服务

- TCP：面向连接(客户机/服务器进程间需要建立连接)、可靠的传输、流量控制、拥塞控制、不提供时间/延迟保障、不提供最小带宽保障
- UDP：无连接、不可靠的数据传输、不提供(可靠性保障、流量控制、拥塞控制、延迟保障、带宽保障)

## Web应用

对象的寻址：URL——统一资源定位符，`Scheme://host:port/path`——协议、主机、端口、路径

### HTTP协议

> 超文本传输协议

无状态协议，使用TCP传输协议

#### 两种类型

- 非持久性连接：每个TCP连接最多传输一个对象，HTTP 1.0使用非持久性连接
- 持久性连接：每个TCP连接允许传输多个对象，HTTP 1.1默认持久性连接

非持久性连接问题：
1. 每个对象需要2个RTT
2. 操作系统需要为每个TCP连接开销资源
3. 打开多个并行的TCP连接以获取网页所需对象，服务器负担很大

持久性连接：发送响应后，服务器保持TCP连接的打开；后续的HTTP消息可以通过这个连接发送

分为两类：无流水的持久性连接；带有流水机制的持久性连接(HTTP 1.1的默认选项)

HTTP 1.0：GET、POST、HEAD
HTTP 1.1: GET、POST、HEAD、PUT、DELETE

#### HTTP消息

请求消息：
```
request line(请求行)
header lines(首部行)
enitity body(实体主体-通常不同)
```

响应消息：
```
status line(状态行)
header lines(首部行)
enitity body(有些响应报文不用)
```

状态码
- 200 ok
- 301 Moved Permanently(永久性转移)
- 400 Bad Request(错误请求)
- 404 Not Found(找不到资源文件)
- 505 HTTP Version Not Supported

#### cookie技术

作用：
- 身份认证
- 购物车
- 推荐
- Web E-mail

隐私问题

#### Web缓存/代理服务器技术
功能：在不访问服务器的前提下满足客户端的HTTP请求

原因：缩短客户请求的响应时间；减少机构/组织的流量；在大范围内实现有效的内容分发

条件行GET方法

## Email应用

构成组件：邮件客户端、邮件服务器、SMTP(Simple Mail Transfer Protocol)

### 邮件服务器

邮箱：存储发给该用户的Email；消息队列：存储等待发送的Email

### SMTP

TCP进行email消息的可靠传输

命令/响应交互模式：命令(ASCII文本)，响应(状态代码和语句)

- Email消息只能包含7位ASCII码
- 使用持久性连接
- 利用`.`换行结束消息

### 消息格式

头部行(header)，空白行，消息体(body)

MIME(多媒体邮件扩展)：通过在邮件头部增加额外的声明MIME的内容类型

### 邮件访问协议

> 从服务器获取邮件

- POP(Post Office Protocol): 认证/授权和下载
- IMAP(Internet Mail Access Protocol): 更多功能、更加复杂、能够操作服务器上存储的消息
- HTTP

#### POP

认证过程、事务阶段、"下载并删除"模式、"下载并保持"模式

POP3是无状态的

#### IMAP

所有消息统一保存在一个地方

## DNS(Domain Name System)

功能：Internet上主机/路由器的识别问题

域名解析系统DNS，应用层协议

- 域名向IP地址的翻译
- 主机别名
- 邮件服务器别名
- 负载均衡：Web服务器

为什么不使用集中式的DNS?
- 单点失败问题
- 流量问题
- 距离问题
- 维护性问题

迭代查询；递归查询

本地域名服务器一般会缓存顶级域名服务器的映射

资源记录(RR)

### DNS协议

查询和回复

消息头部：Identification、flags
